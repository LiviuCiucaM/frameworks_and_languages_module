<html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
    <meta name="viewport" content="width=device-width">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

    <title>FreeCycle</title>
    <style>

    /* styles here */

    </style>
   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Free Cycle</a>
    </div>
  </nav>
    <div id="app">
      <form @:submit.prevent="create_item">
        <label>UserName : </label>
        <input v-model="item.user_id" name="user_id" type ="text" placeholder="name"> <br>

        <label>lat : </label>
        <input v-model="item.lat" name="lat" type="text"><br>

        <label>lon : </label>
        <input v-model="item.lon" name="lon" type="text"><br>

        <label>image : </label>
        <input v-model="item.image" name="image" type="text"><br>

        <label>Keywords : </label>
        <input v-model="item.keywords" name="keywords" type="text"><br>

        <label>Description : </label>
        <textarea v-model="item.description" name="description"></textarea><br>
        <button data-action="create_item" type="submit">Submit</button>
      </form>

      <div class="container my-3" style="display:inline-block ;">
        <ul style="list-style: none;">
          <li v-for="item in items">
            <div class="row">
              <div class="col-sm">
                  <div class="card border-primary mb-3" style="max-width: 18rem;">
                    <img :src="item.image" class="card-img-top">
                    <div class="card-body">
                      <h5 class="card-title"> User Id: {{item.user_id}}</h5>
                      <p data-field="id"> List Id: {{item.id}}</p>
                      <p class="card-text"> Keyword: {{item.keywords}}</p>
                      <p class="card-text">Lat: {{item.lat}}</p>
                      <p class="card-text">Lon: {{item.lon}}</p>
                      <p class="card-text">Date: {{item.date_from}}</p>
                      <p class="card-text">Description: {{item.description}}</p>
                      <button @click="delete_item(item.id)" data-action="delete" class="btn btn-primary">Delete</button>
                  </div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    
    
    </div>
    <script type="module">
    const { createApp } = Vue
    let API = '' //'https://8000-reem313-frameworksandla-lt146dhjlm1.ws-eu74.gitpod.io'
    const urlParams = new URLSearchParams(window.location.search);
	  const urlAPI = (urlParams.get('api') || DEFAULT_API).replace(/\/$/, '');  // Get api url (and remove trailing slash if present)
    const DEFAULT_API = '/api/v1';  // default to current http(s)://currentHost:currentPort/api/v1'

    createApp({
      data() {
        return {
          item: {
            id:'',
            user_id:'',
            keywords:'',
            lat:'',
            lon:'',
            image:'',
            date_from:'',
            description:'',
          },
          items:[],
        }
      },
      created(){
        this.clear_item()
        this.get_items()
      },
    methods:{
      clear_item(){
        this.item= { ...this.item, ...{
            user_id:'',
            keywords:'',
            lat:'',
            lon:'',
            image:'',
            description:'',
        }}
      },
        create_item() {
         fetch(`${urlAPI}/item`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(this.item),
          })
          .then(response => response.json())
          .then(json => console.log('create_item()', json))
          .then(this.clear_item)
          .then(this.get_items)
        .catch(err => console.error(err));
        },
        get_items() {
         fetch(`${urlAPI}/items`, {
            method: 'GET',
          })
          .then(response => response.json())
          .then(data => this.items=data)
          //.then(data => console.log('data', data))
        .catch(err => console.error(err));
        },
        delete_item(item_id){
            fetch(`${urlAPI}/item/${item_id}`,{
                method: 'DELETE',
            })
            .then(json => console.log('delete_item()', json))
            .then(this.get_items)
              .catch(err => console.error(err));
        }
      },
    }).mount('#app')
    </script>
  </body>
</html>
